<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“š Ù…Ù†ØµØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #0f172a;
      color: #f8fafc;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1e293b;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }
    header h1 {
      margin: 0;
      font-size: 26px;
      color: #38bdf8;
    }
    .filters {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }
    select {
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #334155;
      color: #f8fafc;
      font-size: 14px;
      cursor: pointer;
    }
    .videos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .video-card {
      background: #1e293b;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.2s;
    }
    .video-card:hover {
      transform: scale(1.03);
    }
    .video-thumb {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    .video-info {
      padding: 15px;
      text-align: right;
    }
    .video-info h3 {
      margin: 0 0 10px;
      font-size: 18px;
      color: #facc15;
    }
    .video-info p {
      margin: 4px 0;
      color: #cbd5e1;
      font-size: 14px;
    }
    iframe, video {
      width: 100%;
      height: 200px;
      border: none;
      border-radius: 10px;
      margin-top: 10px;
    }
    .actions {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }
    .edit-btn { background: #f59e0b; color: #fff; }
    .delete-btn { background: #ef4444; color: #fff; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
  </header>

  <div class="filters">
    <select id="subjectSelect">
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
    </select>
    <select id="teacherSelect">
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³</option>
    </select>
  </div>

  <div class="videos-grid" id="videosList"></div>

  <script>
    // Firebase config
    const firebaseConfig = {
      databaseURL: "https://alamer-526ff-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const videosRef = db.ref("videos");

    const subjectSelect = document.getElementById("subjectSelect");
    const teacherSelect = document.getElementById("teacherSelect");
    const videosList = document.getElementById("videosList");

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯
    videosRef.on("value", snapshot => {
      let subjects = new Set();
      snapshot.forEach(child => {
        const data = child.val();
        if (data.subject) subjects.add(data.subject);
      });

      subjectSelect.innerHTML = `<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>`;
      subjects.forEach(sub => {
        const option = document.createElement("option");
        option.value = sub;
        option.textContent = sub;
        subjectSelect.appendChild(option);
      });
    });

    // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø§Ø¯Ø© â†’ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†
    subjectSelect.addEventListener("change", () => {
      teacherSelect.innerHTML = `<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³</option>`;
      if (!subjectSelect.value) return;

      videosRef.orderByChild("subject").equalTo(subjectSelect.value).once("value", snapshot => {
        let teachers = new Set();
        snapshot.forEach(child => {
          const data = child.val();
          if (data.teacher) teachers.add(data.teacher);
        });

        teachers.forEach(t => {
          const option = document.createElement("option");
          option.value = t;
          option.textContent = t;
          teacherSelect.appendChild(option);
        });
      });
    });

    // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ø±Ø³ â†’ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
    teacherSelect.addEventListener("change", () => {
      loadVideos(subjectSelect.value, teacherSelect.value);
    });

    function loadVideos(subject, teacher) {
      videosList.innerHTML = "";
      db.ref("videos").orderByChild("teacher").equalTo(teacher).on("value", snapshot => {
        videosList.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          if (data.subject !== subject) return; // ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ù…Ø§Ø¯Ø© + Ø§Ù„Ù…Ø¯Ø±Ø³

          const card = document.createElement("div");
          card.className = "video-card";

          let videoElement = "";
          if (data.url.includes("youtube.com") || data.url.includes("youtu.be")) {
            videoElement = `<iframe src="${data.url}" allowfullscreen></iframe>`;
          } else {
            videoElement = `<video controls><source src="${data.url}" type="video/mp4"></video>`;
          }

          card.innerHTML = `
            <img class="video-thumb" src="${data.imageUrl || ''}" alt="ØµÙˆØ±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
            <div class="video-info">
              <h3>${data.title}</h3>
              <p>ğŸ“˜ ${data.subject}</p>
              <p>ğŸ‘¨â€ğŸ« ${data.teacher}</p>
              ${videoElement}
              <div class="actions">
                <button class="btn edit-btn" onclick="editVideo('${child.key}','${data.title}','${data.url}','${data.subject}','${data.teacher}','${data.imageUrl || ''}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="btn delete-btn" onclick="deleteVideo('${child.key}')">ğŸ—‘ Ø­Ø°Ù</button>
              </div>
            </div>
          `;
          videosList.appendChild(card);
        });
      });
    }

    // Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    function deleteVideo(key) {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ")) {
        db.ref("videos/" + key).remove();
      }
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    function editVideo(key, oldTitle, oldUrl, oldSubject, oldTeacher, oldImage) {
      const newTitle = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:", oldTitle);
      if (!newTitle) return;
      const newUrl = prompt("Ø§ÙƒØªØ¨ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯:", oldUrl);
      if (!newUrl) return;
      const newSubject = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:", oldSubject);
      if (!newSubject) return;
      const newTeacher = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³:", oldTeacher);
      if (!newTeacher) return;
      const newImage = prompt("Ø¶Ø¹ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù:", oldImage);
      if (!newImage) return;

      db.ref("videos/" + key).update({
        title: newTitle,
        url: newUrl,
        subject: newSubject,
        teacher: newTeacher,
        imageUrl: newImage
      });
    }
  </script>
</body>
</html>
