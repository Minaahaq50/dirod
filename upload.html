<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª + Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      padding: 20px;
    }
    input, select, button {
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    input, select {
      width: 300px;
      background-color: #1e1e1e;
      color: white;
    }
    button {
      background-color: #6200ee;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #3700b3;
    }

    .toast {
      margin-top: 10px;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      display: none;
      animation: fadeIn 0.5s, fadeOut 0.5s 2s;
    }
    .toast.success { background-color: #2e7d32; color: #fff; }
    .toast.error { background-color: #c62828; color: #fff; }

    @keyframes fadeIn { from {opacity: 0; transform: translateY(-10px);} to {opacity: 1; transform: translateY(0);} }
    @keyframes fadeOut { from {opacity: 1; transform: translateY(0);} to {opacity: 0; transform: translateY(-10px);} }

    canvas {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 10px;
      margin-top: 20px;
    }

    #adminPanel { display: none; } /* Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ø´Ø± Ù…Ø®ÙÙŠØ© Ù„Ø­Ø¯ Ù…Ø§ ÙŠØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† */
  </style>
</head>
<body>

  <h2>ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"><br>
  <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
  <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

  <div id="toast" class="toast"></div>

  <!-- Ù„ÙˆØ­Ø© Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
  <div id="adminPanel">
    <h2>ğŸ“¤ Ù†Ø´Ø± ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="titleInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"><br>
    <input type="text" id="urlInput" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨ØµÙŠØºØ© embed"><br>
    <input type="text" id="imageInput" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (thumbnail)"><br>
    
    <select id="subjectInput" onchange="updateTeachers()">
      <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
      <option value="Ø¹Ø±Ø¨ÙŠ">Ø¹Ø±Ø¨ÙŠ</option>
      <option value="Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ">Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</option>
      <option value="Ø¬ØºØ±Ø§ÙÙŠØ§">Ø¬ØºØ±Ø§ÙÙŠØ§</option>
      <option value="ØªØ§Ø±ÙŠØ®">ØªØ§Ø±ÙŠØ®</option>
      <option value="ÙÙŠØ²ÙŠØ§Ø¡">ÙÙŠØ²ÙŠØ§Ø¡</option>
      <option value="ÙƒÙŠÙ…ÙŠØ§Ø¡">ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
      <option value="Ø£Ø­ÙŠØ§Ø¡">Ø£Ø­ÙŠØ§Ø¡</option>
      <option value="Ø§Ø¯Ø¨ÙŠ">Ø§Ø¯Ø¨ÙŠ</option>
    </select><br>

    <select id="teacherInput" disabled>
      <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³</option>
    </select><br>

    <button onclick="publishVideo()">Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>

    <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©</h2>
    <canvas id="videosChart" width="400" height="200"></canvas>
  </div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCdhj73cKJc2J2_tDHw2-89EemZx-EGMJQ",
      authDomain: "alamer-526ff.firebaseapp.com",
      databaseURL: "https://alamer-526ff-default-rtdb.firebaseio.com",
      projectId: "alamer-526ff",
      storageBucket: "alamer-526ff.firebasestorage.app",
      messagingSenderId: "523879269039",
      appId: "1:523879269039:web:634861aa34641bfebf8a5a",
      measurementId: "G-4L48BTMLHB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // ğŸ” UID Ø§Ù„Ø£Ø¯Ù…Ù†
    const ADMIN_UID ="Se5eNLTKoqUGjeShmRJRHDiKogF3"

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function login() {
      const email = document.getElementById("emailInput").value.trim();
      const password = document.getElementById("passwordInput").value.trim();

      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          if (user.uid === ADMIN_UID) {
            showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù† âœ…");
            document.getElementById("adminPanel").style.display = "block";
          } else {
            showToast("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠØ³ Ø£Ø¯Ù…Ù†", true);
            auth.signOut();
          }
        })
        .catch(error => {
          showToast("Ø®Ø·Ø£: " + error.message, true);
        });
    }

    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ù„ÙƒÙ„ Ù…Ø§Ø¯Ø©
    const teachersPerSubject = {
      "Ø¹Ø±Ø¨ÙŠ": ["Ù…Ø­Ù…Ø¯ ØµÙ„Ø§Ø­", "Ø±Ø¶Ø§ ÙØ§Ø±ÙˆÙ‚", "Ù…Ø¯Ø±Ø³ Ø¬"],
      "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ": ["Ù…Ø³ Ù…ÙŠ", "Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ù„ØºÙ‡", "ÙˆØ§Ø¦Ù„ Ù…ÙŠÙ„Ø§Ø¯"],
      "Ø¬ØºØ±Ø§ÙÙŠØ§": ["Ù…Ø¯Ø±Ø³ 1", "Ù…Ø¯Ø±Ø³ 2", "Ù…Ø¯Ø±Ø³ 3"],
      "ØªØ§Ø±ÙŠØ®": ["Ù…Ø¯Ø±Ø³ 1", "Ù…Ø¯Ø±Ø³ 2", "Ù…Ø¯Ø±Ø³ 3"],
      "ÙÙŠØ²ÙŠØ§Ø¡": ["ÙƒÙŠØ±Ù„Ø³ Ø§Ù„Ù‚Øµ ", "Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø¹Ø¨ÙˆØ¯ 2", "ÙÙŠØ²ÙŠØ§Ø¦ÙŠ 3"],
      "ÙƒÙŠÙ…ÙŠØ§Ø¡": ["Ø®Ø§Ù„Ø¯ ØµÙ‚Ø±", "Ø¹Ø¨Ø¯ Ø§Ù„Ø¬ÙˆØ§Ø¯", "Ø¬ÙˆÙ† Ø¬Ù‡Ø¨Ø°"],
      "Ø£Ø­ÙŠØ§Ø¡": ["Ø§Ø­Ù…Ø¯ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ", "Ø§Ø­Ù…Ø¯ Ø§ÙŠÙ…Ù†", "Ø§Ù„Ø¬ÙŠÙˆ", "Ø§Ù…Ù†ÙŠÙ‡ Ø§Ù„Ø³ÙŠØ¯"],
      "Ø§Ø¯Ø¨ÙŠ": ["Ø§Ù„Ù…Ø¤Ø±Ø®(Øª)", "Ø§Ù„Ù‚ÙŠØµØ±(Ø¬)", "Ø¬ÙŠÙˆ Ù…Ø§Ø¬Ø¯","Ø¬ÙˆÙ‡Ø±ÙŠ(Ø¬ÙŠÙˆ)"]
    };

    function updateTeachers() {
      const subject = document.getElementById("subjectInput").value;
      const teacherSelect = document.getElementById("teacherInput");
      teacherSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³</option>';

      if (!subject || !teachersPerSubject[subject]) {
        teacherSelect.disabled = true;
        return;
      }

      teachersPerSubject[subject].forEach(teacher => {
        const option = document.createElement("option");
        option.value = teacher;
        option.textContent = teacher;
        teacherSelect.appendChild(option);
      });
      teacherSelect.disabled = false;
    }

    // Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    function publishVideo() {
      const title = document.getElementById("titleInput").value.trim();
      const url = document.getElementById("urlInput").value.trim();
      const imageUrl = document.getElementById("imageInput").value.trim();
      const subject = document.getElementById("subjectInput").value;
      const teacher = document.getElementById("teacherInput").value;

      if (!title || !url || !imageUrl || !subject || !teacher) {
        showToast("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ù…Ø§ ÙÙŠÙ‡Ø§ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©", true);
        return;
      }

      const videoId = Date.now();
      db.ref("videos/" + videoId).set({ title, url, imageUrl, subject, teacher }, (error) => {
        if (error) {
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", true);
        } else {
          showToast("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…");
          document.getElementById("titleInput").value = "";
          document.getElementById("urlInput").value = "";
          document.getElementById("imageInput").value = "";
          document.getElementById("subjectInput").selectedIndex = 0;
          document.getElementById("teacherInput").innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³</option>';
          document.getElementById("teacherInput").disabled = true;
        }
      });
    }

    // ØªÙˆØ³Øª
    function showToast(message, isError = false) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = "toast " + (isError ? "error" : "success");
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 2500);
    }

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
    const subjects = ["Ø¹Ø±Ø¨ÙŠ", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ø¬ØºØ±Ø§ÙÙŠØ§", "ØªØ§Ø±ÙŠØ®", "ÙÙŠØ²ÙŠØ§Ø¡", "ÙƒÙŠÙ…ÙŠØ§Ø¡", "Ø£Ø­ÙŠØ§Ø¡", "Ø§Ø¯Ø¨ÙŠ"];
    let counts = {};
    subjects.forEach(sub => counts[sub] = 0);

    db.ref("videos").on("value", (snapshot) => {
      subjects.forEach(sub => counts[sub] = 0);
      snapshot.forEach(child => {
        const data = child.val();
        if (counts[data.subject] !== undefined) {
          counts[data.subject]++;
        }
      });
      updateChart();
    });

    let chart;
    function updateChart() {
      const ctx = document.getElementById("videosChart").getContext("2d");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: subjects,
          datasets: [{
            label: 'Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª',
            data: subjects.map(sub => counts[sub]),
            backgroundColor: 'rgba(98, 0, 238, 0.7)',
            borderColor: 'rgba(98, 0, 238, 1)',
            borderWidth: 1,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false }},
          scales: {
            y: { beginAtZero: true, ticks: { color: "white" }},
            x: { ticks: { color: "white" }}
          }
        }
      });
    }
  </script>
</body>
</html>
