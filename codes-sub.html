<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة إدارة THE BEST</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<style>
body { font-family: 'Cairo', sans-serif; background: #141E30; color: white; margin: 0; padding: 20px; }
h1 { text-align: center; color: #00f5c4; margin-bottom: 20px; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 12px; border-bottom: 1px solid #444; text-align: center; }
th { background-color: #0072ff; color: white; }
tr:hover { background-color: rgba(0, 197, 255, 0.2); }
button { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
button.approve { background-color: #00f5c4; color: #000; }
button.delete { background-color: #ff4f4f; color: #fff; margin-left: 5px; }
button:hover { transform: scale(1.05); }
#status { text-align:center; margin-bottom:10px; color:#00f5c4; }
#error { text-align:center; margin-bottom:10px; color:#ff4f4f; }
</style>
</head>
<body>

<h1>لوحة إدارة الطلبات</h1>
<p id="status"></p>
<p id="error"></p>

<table>
  <thead>
    <tr>
      <th>الاسم</th>
      <th>رقم الهاتف</th>
      <th>الوقت</th>
      <th>إجراءات</th>
    </tr>
  </thead>
  <tbody id="requestsTable">
    <!-- الطلبات ستظهر هنا -->
  </tbody>
</table>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCdhj73cKJc2J2_tDHw2-89EemZx-EGMJQ",
  authDomain: "alamer-526ff.firebaseapp.com",
  databaseURL: "https://alamer-526ff-default-rtdb.firebaseio.com",
  projectId: "alamer-526ff",
  storageBucket: "alamer-526ff.appspot.com",
  messagingSenderId: "523879269039",
  appId: "1:523879269039:web:634861aa34641bfebf8a5a"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const requestsTable = document.getElementById("requestsTable");
const statusEl = document.getElementById("status");
const errorEl = document.getElementById("error");

// UID المسؤول
const adminUid = "Se5eNLTKoqUGjeShmRJRHDiKogF3";

// تسجيل الدخول المجهول للوحة الإدارة
auth.signInAnonymously()
.then(res => {
  if(res.user.uid !== adminUid){
    errorEl.textContent = "❌ ليس لديك صلاحية الوصول للوحة الإدارة.";
    return;
  }
  statusEl.textContent = "✅ تم تسجيل الدخول كمسؤول.";
  loadRequests();
})
.catch(err => {
  errorEl.textContent = "❌ حدث خطأ أثناء تسجيل الدخول.";
  console.error(err);
});

// تحميل الطلبات
function loadRequests(){
  db.ref("pendingStudents").once("value")
    .then(snapshot => {
      requestsTable.innerHTML = "";
      if(!snapshot.exists()){
        requestsTable.innerHTML = "<tr><td colspan='4'>لا توجد طلبات حالياً.</td></tr>";
        return;
      }

      snapshot.forEach(snap => {
        const data = snap.val();
        const uid = snap.key;
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${data.name}</td>
          <td>${data.phone}</td>
          <td>${new Date(data.timestamp).toLocaleString()}</td>
          <td>
            <button class="approve">موافقة</button>
            <button class="delete">حذف</button>
          </td>
        `;

        // زر الموافقة
        row.querySelector(".approve").addEventListener("click", ()=>{
          db.ref("approvedStudents/"+uid).set({
            name:data.name,
            phone:data.phone,
            timestamp:data.timestamp
          }).then(()=>{
            db.ref("pendingStudents/"+uid).remove();
            statusEl.textContent = `✅ تم الموافقة على ${data.name}`;
            loadRequests();
          }).catch(err=>{
            errorEl.textContent = "❌ حدث خطأ أثناء الموافقة.";
            console.error(err);
          });
        });

        // زر الحذف
        row.querySelector(".delete").addEventListener("click", ()=>{
          db.ref("pendingStudents/"+uid).remove()
            .then(()=>{
              statusEl.textContent = `✅ تم حذف ${data.name}`;
              loadRequests();
            }).catch(err=>{
              errorEl.textContent = "❌ حدث خطأ أثناء الحذف.";
              console.error(err);
            });
        });

        requestsTable.appendChild(row);
      });
    })
    .catch(err=>{
      errorEl.textContent = "❌ حدث خطأ أثناء تحميل الطلبات.";
      console.error(err);
    });
}
</script>

</body>
</html>

