<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ - Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; background: #121212; color: white; padding: 20px; }
    h1 { text-align: center; color: #00ffcc; }
    input, button { padding: 10px; margin: 5px; border-radius: 5px; border: none; }
    button { cursor: pointer; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #555; padding: 10px; text-align: center; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>Ù„ÙˆØ­Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ - Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·</h1>

<div id="loginDiv">
  <input type="email" id="email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  <p id="loginStatus"></p>
</div>

<div id="panelDiv" class="hidden">
  <input type="number" id="minutesInput" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚">
  <button onclick="generateCode()">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ ØªØ¬Ø±Ø¨Ø©</button>
  <button onclick="generateMonthlyCode()">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ø´ØªØ±Ø§Ùƒ</button>

  <table id="codesTable">
    <thead>
      <tr>
        <th>Ø§Ù„ÙƒÙˆØ¯</th>
        <th>Code ID</th>
        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
        <th>Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ¯</th>
        <th>Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„</th>
        <th>Ø­Ø°Ù</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "https://alamer-526ff-default-rtdb.firebaseio.com/",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  const codesRef = db.ref("codes");

  const adminUID = "UID_Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„"; // Ø¶Ø¹ Ù‡Ù†Ø§ UID Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const status = document.getElementById("loginStatus");

    auth.signInWithEmailAndPassword(email, password)
      .then(userCredential => {
        if(userCredential.user.uid !== adminUID){
          status.textContent = "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„!";
          auth.signOut();
        } else {
          document.getElementById("loginDiv").classList.add("hidden");
          document.getElementById("panelDiv").classList.remove("hidden");
          status.textContent = "";
          loadCodes();
        }
      })
      .catch(error => {
        status.textContent = "âŒ " + error.message;
      });
  }

  function generateRandomCode(length = 8){
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let result = "";
    for(let i=0;i<length;i++) result += chars.charAt(Math.floor(Math.random()*chars.length));
    return Date.now().toString(36).toUpperCase() + "-" + result;
  }

  function generateCode(){
    const minutes = parseInt(document.getElementById("minutesInput").value);
    if(isNaN(minutes) || minutes <= 0) return alert("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø¯Ù‚Ø§Ø¦Ù‚ ØµØ§Ù„Ø­");
    const code = generateRandomCode();
    const now = Date.now();
    const expire = now + (minutes*60*1000);
    codesRef.push({ code, timestamp: now, expire, deviceId: null });
  }

  function generateMonthlyCode(){
    const code = generateRandomCode();
    const now = Date.now();
    const expire = now + (30*24*60*60*1000);
    codesRef.push({ code, timestamp: now, expire, deviceId: null });
  }

  function formatDate(ms){
    const date = new Date(ms);
    return date.toLocaleDateString("ar-EG") + " - " + date.toLocaleTimeString("ar-EG");
  }

  function restartCode(key){
    const minutes = parseInt(prompt("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", "1"));
    if(isNaN(minutes) || minutes <= 0) return alert("Ø¹Ø¯Ø¯ Ø¯Ù‚Ø§Ø¦Ù‚ ØºÙŠØ± ØµØ§Ù„Ø­");
    const now = Date.now();
    const expire = now + (minutes*60*1000);
    codesRef.child(key).update({ timestamp: now, expire, deviceId: null });
  }

  function deleteCode(key){ if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) codesRef.child(key).remove(); }

  function loadCodes(){
    codesRef.on("value", snapshot=>{
      const tbody = document.querySelector("#codesTable tbody");
      tbody.innerHTML="";
      snapshot.forEach(child=>{
        const data = child.val();
        const tr = document.createElement("tr");
        let status="ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…";
        if(data.deviceId) status="Ù…ÙØ¹Ù„ âœ…";
        else if(Date.now()>data.expire) status="Ù…Ù†ØªÙ‡ÙŠ âŒ";
        tr.innerHTML=`
          <td>${data.code}</td>
          <td>${child.key}</td>
          <td>${formatDate(data.timestamp)}</td>
          <td>${formatDate(data.expire)}</td>
          <td>${status}</td>
          <td><button onclick="restartCode('${child.key}')">ğŸ”„</button></td>
          <td><button onclick="deleteCode('${child.key}')">ğŸ—‘</button></td>
        `;
        tbody.appendChild(tr);
      });
    });
  }
</script>

</body>
</html>
